<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Helix Calculator</title>
  <link rel="stylesheet" href="pico.min.css">
  <style>
    body {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .input-row input {
      width: 100%;
    }
    .result-card {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
    button.small {
      width: 2.5rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Helix Calculator</h1>

    <article>
      <div class="input-row">
        <label>Outer Length (mm)</label>
        <button class="small" onclick="changeValue('outerLength', -1)">−</button>
        <input id="outerLength" type="number" value="30" step="0.5">
        <button class="small" onclick="changeValue('outerLength', 1)">+</button>
      </div>

      <div class="input-row">
        <label>Cut Angle (°)</label>
        <button class="small" onclick="changeValue('cutAngle', -0.5)">−</button>
        <input id="cutAngle" type="number" value="7.5" step="0.5">
        <button class="small" onclick="changeValue('cutAngle', 0.5)">+</button>
      </div>

      <div class="input-row">
        <label>Pipe Diameter (inches)</label>
        <button class="small" onclick="changeValue('pipeDiameter', -0.1)">−</button>
        <input id="pipeDiameter" type="number" value="2.5" step="0.1">
        <button class="small" onclick="changeValue('pipeDiameter', 0.1)">+</button>
      </div>

      <div class="input-row">
        <label>Desired Length (mm)</label>
        <button class="small" onclick="changeValue('desiredLength', -10)">−</button>
        <input id="desiredLength" type="number" value="1000" step="10">
        <button class="small" onclick="changeValue('desiredLength', 10)">+</button>
      </div>

      <button id="calcBtn" class="contrast">Calculate</button>
    </article>

    <h2>Viable Helices</h2>
    <div id="results"></div>
  </main>

  <script src="plotly-3.1.0.min.js"></script>
  <script src="helper_functions.js"></script>
  <script src="plottinghelix.js"></script>
  <script>
    const H = window.HelixHelpers;

    function changeValue(id, delta) {
      const el = document.getElementById(id);
      el.value = parseFloat(el.value) + delta;
    }

    function calcHelices() {
      const outerLength = parseFloat(document.getElementById('outerLength').value);
      const cutAngle = parseFloat(document.getElementById('cutAngle').value);
      const pipeDiameterInches = parseFloat(document.getElementById('pipeDiameter').value);
      const desiredLength = parseFloat(document.getElementById('desiredLength').value);

      // Convert units and parameters
      const pipeDiameter = pipeDiameterInches * 25.4; // inches → mm
      const theta = cutAngle * 2;                     // cutAngle corresponds to theta/2
      const L = H.center_length_from_outer(outerLength, cutAngle, pipeDiameter);

      const results = H.list_possible_helices(L, theta, pipeDiameter, desiredLength);
      const container = document.getElementById('results');
      container.innerHTML = "";

      if (!results.length) {
        container.innerHTML = "<p>No valid helices found for these parameters.</p>";
        return;
      }

      results.forEach(row => {
        const [tau, Nsegments, actualLength, Nturns, outer_diameter, donut_hole, deltaz, turns_per_segment] = row;
        const div = document.createElement('div');
        div.className = 'result-card';
        div.innerHTML = `
          <b>Twist angle:</b> ${tau.toFixed(2)}°<br>
          <b>Segments:</b> ${Nsegments}<br>
          <b>Length:</b> ${actualLength.toFixed(1)} mm<br>
          <b>Turns:</b> ${Nturns.toFixed(2)}<br>
          <b>Outer diameter:</b> ${outer_diameter.toFixed(1)} mm
          <br><br>
          <button onclick="visualize(${L}, ${theta}, ${tau}, ${Nsegments}, ${pipeDiameter})">Visualize</button>
        `;
        container.appendChild(div);
      });
    }

    function visualize(L, theta, tau, segments, pipeDiameter) {
      const params = new URLSearchParams({ L, theta, tau, segments, pipeDiameter });
      window.open('visualize.html?' + params.toString(), '_blank');
    }

    document.getElementById('calcBtn').addEventListener('click', calcHelices);
  </script>
</body>
</html>
