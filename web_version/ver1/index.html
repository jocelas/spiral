<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Helix Calculator</title>
  <link rel="stylesheet" href="pico.min.css">
  <link rel="stylesheet" href="mobile-friendly.css">
  <style>
  </style>
</head>
<body>
  <main>
    <h1>Helix Calculator</h1>

    <article>
      <div class="input-row">
        <label>Outer Length (mm)</label>
        <button class="small" onclick="changeValue('outerLength', -1)">−</button>
        <input id="outerLength" type="number" value="30" step="0.5">
        <button class="small" onclick="changeValue('outerLength', 1)">+</button>
      </div>

      <div class="input-row">
        <label>Cut Angle (°)</label>
        <button class="small" onclick="changeValue('cutAngle', -0.5)">−</button>
        <input id="cutAngle" type="number" value="7.5" step="0.5">
        <button class="small" onclick="changeValue('cutAngle', 0.5)">+</button>
      </div>

      <div class="input-row">
        <label>Pipe Diameter (inches)</label>
        <button class="small" onclick="changeValue('pipeDiameter', -0.1)">−</button>
        <input id="pipeDiameter" type="number" value="2.5" step="0.1">
        <button class="small" onclick="changeValue('pipeDiameter', 0.1)">+</button>
      </div>

      <div class="input-row">
        <label>Desired Length (mm)</label>
        <button class="small" onclick="changeValue('desiredLength', -10)">−</button>
        <input id="desiredLength" type="number" value="1000" step="10">
        <button class="small" onclick="changeValue('desiredLength', 10)">+</button>
      </div>

      <button id="calcBtn" class="contrast">Calculate</button> <span style="margin-left: 5em">(Results below)</span>
    </article>

    <h2>Viable Helices</h2>
    <div class="scroll-container">
      <table id="resultsTable">
        <thead>
          <tr>
            <th>Twist<br>(°)</th>
            <th>#<br>Segments</th>
            <th>Length<br>(mm)</th>
            <th>#<br>turns</th>
            <th>Outer Ø<br>(mm)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="resultsBody">
          <tr><td colspan="6">No results yet.</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <script src="plotly-3.1.0.min.js"></script>
  <script src="helper_functions.js"></script>
  <script src="plottinghelix.js"></script>
  <script>
    const H = window.HelixHelpers;

    function changeValue(id, delta) {
      const el = document.getElementById(id);
      el.value = (parseFloat(el.value) + delta).toFixed(2);
    }

    function calcHelices() {
      const outerLength = parseFloat(document.getElementById('outerLength').value);
      const cutAngle = parseFloat(document.getElementById('cutAngle').value);
      const pipeDiameterInches = parseFloat(document.getElementById('pipeDiameter').value);
      const desiredLength = parseFloat(document.getElementById('desiredLength').value);

      const pipeDiameter = pipeDiameterInches * 25.4;
      const theta = cutAngle * 2;
      const L = H.center_length_from_outer(outerLength, cutAngle, pipeDiameter);

      const results = H.list_possible_helices(L, theta, pipeDiameter, desiredLength);
      const tbody = document.getElementById('resultsBody');
      tbody.innerHTML = "";

      if (!results.length) {
        tbody.innerHTML = `<tr><td colspan="6">No valid helices found for these parameters.</td></tr>`;
        return;
      }

      for (const row of results) {
        const [tau, Nsegments, actualLength, Nturns, outer_diameter] = row;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${tau.toFixed(2)}</td>
          <td>${Nsegments}</td>
          <td>${actualLength.toFixed(1)}</td>
          <td>${Nturns.toFixed(2)}</td>
          <td>${outer_diameter.toFixed(1)}</td>
          <td class="actions">
            <button class="visualize-btn" onclick="visualize(${L}, ${theta}, ${tau}, ${Nsegments}, ${pipeDiameter})">View</button>
            <button class="visualize-btn secondary" onclick="inspect(${outerLength}, ${theta}, ${tau}, ${Nsegments}, ${pipeDiameter})">Inspect</button>
          </td>
        `;
        tbody.appendChild(tr);
      }
    }

    function visualize(L, theta, tau, segments, pipeDiameter) {
      const params = new URLSearchParams({ L, theta, tau, segments, pipeDiameter });
      window.open('visualize.html?' + params.toString(), '_blank');
    }

    function inspect(outerLength, theta, tau, segments, pipeDiameter) {
      const params = new URLSearchParams({ outerLength, theta, tau, segments, pipeDiameter });
      window.location.href = 'playground.html?' + params.toString();
    }

    document.getElementById('calcBtn').addEventListener('click', calcHelices);
  </script>


  <article>
    <h2>Usage</h2>

    <ul>
      <li><b>Outer Length: </b>outer length of pipe (see image below</li>
      <li><b>Cut angle:</b> see image below</li>
    </ul>
    <img src = "pipe.png" style = "width: 50%; background-color: white; font-family: sans-serif; padding: 20px; border-radius: 20px; justify-content: center; margin-left: 20%; text-align: center">

    
  </article>
</body>
</html>
